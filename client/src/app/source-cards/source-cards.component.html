<div class="container">
  <div class="header">
    <div>
      <h1>Cards</h1>
      <p>
        <a [routerLink]="['/sources']" class="breadcrumb-link">Sources</a>
        <span class="breadcrumb-separator">/</span>
        <span>{{ sourceId() }}</span>
      </p>
    </div>
    <a mat-button [routerLink]="['/sources']">
      <mat-icon>arrow_back</mat-icon>
      Back to Sources
    </a>
  </div>

  <div class="filters-section" role="search" aria-label="Card filters">
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>State</mat-label>
      <mat-select
        [value]="stateFilter()"
        (selectionChange)="stateFilter.set($event.value); onFilterChange()"
        aria-label="Filter by state"
      >
        @for (option of stateOptions; track option) {
          <mat-option [value]="option">{{ getStateLabel(option) }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Reviews</mat-label>
      <mat-select
        [value]="reviewCountFilter()"
        (selectionChange)="reviewCountFilter.set($event.value); onFilterChange()"
        aria-label="Filter by review count"
      >
        @for (option of reviewCountOptions; track option.value) {
          <mat-option [value]="option.value">{{ option.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Last Review</mat-label>
      <mat-select
        [value]="reviewDateFilter()"
        (selectionChange)="reviewDateFilter.set($event.value); onFilterChange()"
        aria-label="Filter by last review date"
      >
        @for (option of reviewDateOptions; track option.value) {
          <mat-option [value]="option.value">{{ option.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Grade</mat-label>
      <mat-select
        [value]="gradeFilter()"
        (selectionChange)="gradeFilter.set($event.value); onFilterChange()"
        aria-label="Filter by last review grade"
      >
        @for (option of gradeOptions; track option) {
          <mat-option [value]="option">{{ getGradeLabel(option) }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  @if (hasSelection()) {
    <div class="actions-bar">
      <span class="selection-count">{{ selectedCount() }} selected</span>
      <button mat-button (click)="markAsKnown()" aria-label="Mark selected cards as known">
        <mat-icon>check_circle</mat-icon>
        Mark as Known
      </button>
      <button mat-button (click)="markAsReady()" aria-label="Mark selected cards as ready">
        <mat-icon>replay</mat-icon>
        Mark as Ready
      </button>
    </div>
  }

  <div class="grid-container">
    <ag-grid-angular
      [theme]="theme"
      style="width: 100%; height: 600px;"
      [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef"
      [rowModelType]="'infinite'"
      [cacheBlockSize]="100"
      [maxBlocksInCache]="10"
      [rowSelection]="{ mode: 'multiRow', checkboxes: true, headerCheckbox: true }"
      [getRowId]="getRowId"
      (gridReady)="onGridReady($event)"
      (selectionChanged)="onSelectionChanged()"
      (rowClicked)="onRowClicked($event)"
    />
  </div>
</div>
