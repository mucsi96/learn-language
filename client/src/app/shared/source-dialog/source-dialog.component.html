<h2 mat-dialog-title>{{ getTitle() }}</h2>
<mat-dialog-content>
  <form>
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Source ID</mat-label>
      <input
        matInput
        [(ngModel)]="formData.id"
        name="id"
        [disabled]="data.mode === 'edit'"
        required
      />
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Name</mat-label>
      <input matInput [(ngModel)]="formData.name" name="name" required />
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Card Type</mat-label>
      <mat-select
        [(ngModel)]="formData.cardType"
        name="cardType"
        [disabled]="data.mode === 'edit'"
        required
      >
        @for (cardType of cardTypes; track cardType.code) {
        <mat-option [value]="cardType.code">{{ cardType.displayName }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Language Level</mat-label>
      <mat-select
        [(ngModel)]="formData.languageLevel"
        name="languageLevel"
        required
      >
        @for (level of languageLevels; track level.code) {
        <mat-option [value]="level.code">{{ level.displayName }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Source Type</mat-label>
      <mat-select
        [(ngModel)]="formData.sourceType"
        name="sourceType"
        [disabled]="data.mode === 'edit'"
        required
      >
        @for (sourceType of sourceTypes; track sourceType.code) {
        <mat-option [value]="sourceType.code">{{ sourceType.displayName }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    @if (formData.cardType !== 'speech') {
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Format Type</mat-label>
      <mat-select
        [(ngModel)]="formData.formatType"
        name="formatType"
        required
      >
        @for (formatType of formatTypes; track formatType.code) {
        <mat-option [value]="formatType.code">{{ formatType.displayName }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    }

    @if (formData.sourceType === 'pdf') {
    <div
      class="dropzone"
      [class.dragging]="isDragging()"
      [class.has-file]="hasFile()"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
    >
      @if (!hasFile()) {
      <div class="dropzone-content">
        <mat-icon class="upload-icon">cloud_upload</mat-icon>
        <p class="dropzone-text">
          Drag and drop a PDF file here or
          <label class="file-input-label">
            browse
            <input
              type="file"
              accept=".pdf"
              (change)="onFileSelected($event)"
              class="file-input"
              aria-label="Upload PDF file"
            />
          </label>
        </p>
        <p class="dropzone-hint">PDF files only</p>
      </div>
      } @else {
      <div class="file-info">
        <mat-icon class="file-icon">description</mat-icon>
        <div class="file-details">
          <p class="file-name">{{ getFileName() }}</p>
          @if (uploadedFile()) {
          <p class="file-size">
            {{ (uploadedFile()!.size / 1024 / 1024).toFixed(2) }} MB
          </p>
          }
        </div>
        <button
          mat-icon-button
          (click)="removeFile()"
          type="button"
          aria-label="Remove file"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      } @if (uploading()) {
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      } @if (uploadError()) {
      <p class="error-message">{{ uploadError() }}</p>
      }
    </div>
    } @else {
    <p class="hint-text">Images will be added from the page view after creating the source.</p>
    }

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Start Page</mat-label>
      <input
        matInput
        type="number"
        [(ngModel)]="formData.startPage"
        name="startPage"
        min="1"
        required
      />
    </mat-form-field>
  </form>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button (click)="onCancelClick()">Cancel</button>
  <button
    mat-flat-button
    (click)="onSaveClick()"
    [disabled]="!isValid()"
  >
    {{ getSaveButtonLabel() }}
  </button>
</mat-dialog-actions>
