<div class="dialog-root">
  <h2 mat-dialog-title class="dialog-title">
    <mat-icon class="dialog-icon">record_voice_over</mat-icon>
    Choose a Voice
  </h2>

  <mat-dialog-content class="dialog-content">
    <p class="dialog-description">
      Pick a voice for this card. Generate a preview, listen, and confirm the one that fits best.
    </p>

    @if (isLoading()) {
      <div class="state state--loading">
        <mat-spinner diameter="32"></mat-spinner>
        <p>Loading available voices...</p>
      </div>
    } @else {
      @if (loadError(); as error) {
        <div class="state state--error">
          <mat-icon>error_outline</mat-icon>
          <p>{{ error }}</p>
          <button mat-stroked-button color="primary" type="button" (click)="retry()">
            Try again
          </button>
        </div>
      } @else if (!voiceGroups().length) {
        <div class="state state--empty">
          <mat-icon>voice_over_off</mat-icon>
          <p>No compatible voices found right now.</p>
        </div>
      } @else {
        <div class="language-groups">
          @for (group of voiceGroups(); track group.languageCode) {
            <section class="language-group">
              <header class="language-header">
                <mat-icon>translate</mat-icon>
                <span>{{ group.languageLabel }}</span>
              </header>

              <div class="voice-cards">
                @for (option of group.options; track option.key) {
                  <article
                    class="voice-card"
                    [class.voice-card--selected]="option.isSelected"
                    [class.voice-card--playing]="isPlaying(option)"
                    [class.voice-card--disabled]="option.isGenerating"
                  >
                    <div class="voice-card__header">
                      <span class="voice-name">{{ option.displayName }}</span>
                      <div class="voice-badges">
                        @if (option.isSelected) {
                          <span class="voice-chip voice-chip--success">Selected</span>
                        }
                        @if (isPlaying(option)) {
                          <span class="voice-chip voice-chip--info">Playing</span>
                        }
                      </div>
                    </div>

                    @if (option.isGenerating) {
                      <div class="voice-card__body voice-card__body--center">
                        <mat-spinner diameter="20"></mat-spinner>
                        <span>Generating preview...</span>
                      </div>
                    } @else {
                      <div class="voice-card__body">
                        @if (option.hasAudio) {
                          <div class="voice-actions">
                            <button
                              mat-icon-button
                              type="button"
                              (click)="play(option, $event)"
                              [attr.aria-label]="isPlaying(option) ? 'Stop preview' : 'Play preview'"
                              matTooltip="{{ isPlaying(option) ? 'Stop preview' : 'Play preview' }}"
                            >
                              <mat-icon>{{ isPlaying(option) ? 'stop' : 'play_arrow' }}</mat-icon>
                            </button>

                            <button
                              mat-stroked-button
                              color="primary"
                              type="button"
                              (click)="select(option, $event)"
                              [disabled]="option.isSelected"
                            >
                              {{ option.isSelected ? 'Already selected' : 'Use this voice' }}
                            </button>
                          </div>
                        } @else {
                          <div class="voice-actions">
                            <button
                              mat-flat-button
                              color="primary"
                              type="button"
                              (click)="generate(option, $event)"
                              [disabled]="!hasInputTexts()"
                            >
                              Generate preview
                            </button>
                          </div>
                          @if (!hasInputTexts()) {
                            <p class="voice-hint">Add text to the card to enable preview generation.</p>
                          }
                        }
                      </div>
                    }
                  </article>
                }
              </div>
            </section>
          }
        </div>
      }
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="dialog-actions">
    <button mat-button type="button" (click)="close()">Close</button>
  </mat-dialog-actions>
</div>
