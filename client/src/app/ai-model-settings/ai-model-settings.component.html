<div class="ai-model-settings-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title><h2>AI Model Settings</h2></mat-card-title>
      <a
        mat-icon-button
        routerLink="/model-usage"
        matTooltip="View model usage logs"
        aria-label="View model usage logs"
      >
        <mat-icon>analytics</mat-icon>
      </a>
    </mat-card-header>
    <mat-card-content>
      @if (settings.isLoading()) {
      <div class="model-type-group">
        <div class="skeleton skeleton-text-medium" style="margin-bottom: 12px"></div>
        <table mat-table [dataSource]="skeletonRows">
          <ng-container matColumnDef="operation">
            <th mat-header-cell *matHeaderCellDef>Operation</th>
            <td mat-cell *matCellDef="let row">
              <div class="skeleton skeleton-text-large"></div>
            </td>
          </ng-container>
          <ng-container matColumnDef="model">
            <th mat-header-cell *matHeaderCellDef>Model</th>
            <td mat-cell *matCellDef="let row">
              <div class="skeleton skeleton-select"></div>
            </td>
          </ng-container>
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row">
              <div class="skeleton skeleton-button"></div>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
      } @else { @for (type of ['CHAT', 'IMAGE', 'AUDIO']; track type) { @if
      (groupedSettings()?.[type]?.length) {
      <div class="model-type-group">
        <h3>
          <mat-icon>{{ getModelTypeIcon(type) }}</mat-icon>
          {{ getModelTypeLabel(type) }}
        </h3>
        <table mat-table [dataSource]="groupedSettings()![type]">
          <ng-container matColumnDef="operation">
            <th mat-header-cell *matHeaderCellDef>Operation</th>
            <td mat-cell *matCellDef="let setting" class="operation-cell">
              {{ setting.operationDisplayName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="model">
            <th mat-header-cell *matHeaderCellDef>Model</th>
            <td mat-cell *matCellDef="let setting" class="model-cell">
              <mat-form-field
                appearance="outline"
                class="model-select"
                subscriptSizing="dynamic"
              >
                <mat-select
                  [value]="setting.modelName"
                  (selectionChange)="onModelChange(setting, $event.value)"
                  [disabled]="savingOperation() === setting.operationType"
                  placeholder="Use default"
                  aria-label="Select model"
                >
                  @for (model of getModelsForType(setting.modelType); track
                  model.id) {
                  <mat-option [value]="model.id">
                    {{ model.displayName }}
                  </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let setting">
              <button
                mat-icon-button
                (click)="clearSetting(setting)"
                [disabled]="
                  !setting.modelName ||
                  savingOperation() === setting.operationType
                "
                matTooltip="Reset to default"
                aria-label="Reset to default"
              >
                <mat-icon>restart_alt</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
      } } }
    </mat-card-content>
  </mat-card>
</div>
