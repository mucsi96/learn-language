@if (isCheckingSession()) {
<div class="learn-card-container">
  <div class="learn-card">
    <app-learn-card-skeleton />
  </div>
</div>
} @else if (!hasSession()) {
<div class="start-state">
  <mat-icon class="start-icon">school</mat-icon>
  @if (hasExistingSession()) {
    <h2>Welcome back!</h2>
    <p>You have an ongoing study session from today.</p>
    <button mat-flat-button color="primary" (click)="startSession()" aria-label="Continue study session">
      <mat-icon>play_arrow</mat-icon>
      Continue
    </button>
  } @else {
    <h2>Ready to study?</h2>
    <p>Click start to begin your study session.</p>
    <button mat-flat-button color="primary" (click)="startSession()" aria-label="Start study session">
      <mat-icon>play_arrow</mat-icon>
      Start
    </button>
  }
</div>
} @else if (currentCardData.isLoading()) {
<div class="learn-card-container">
  <div class="learn-card">
    <app-learn-card-skeleton />
  </div>
</div>
} @else if (card() === null || card() === undefined) {
<div class="empty-state">
  <mat-icon class="empty-icon">school</mat-icon>
  <h2>All caught up!</h2>
  <p>No cards are due for review right now.</p>
  <p>Great job keeping up with your studies! ðŸŽ‰</p>
</div>
} @else {
<div class="learn-card-container">
  <div class="session-stats" role="status" aria-label="Session card counts">
    @for (stateCount of stateCounts(); track stateCount.state) {
      <app-state [state]="stateCount.state" [count]="stateCount.count" />
    }
  </div>
  <div
    class="learn-card"
    [class.revealed]="isRevealed()"
    (click)="toggleReveal()"
  >
    <div class="card-bottom-controls">
      @if (isStudyingWithPartner()) {
      <span class="turn-indicator" role="status" aria-label="Current turn" aria-live="polite">
        {{ currentTurn().name }}
      </span>
      }
      <app-card-actions
        [card]="cardResource"
        [languageTexts]="languageTexts()"
        (cardProcessed)="onCardProcessed()">
      </app-card-actions>
    </div>

    @switch (currentCardType()) {
      @case ('vocabulary') {
        <app-learn-vocabulary-card
          [card]="cardResource"
          [isRevealed]="isRevealed()"
          [onPlayAudio]="playAudioForContent.bind(this)">
        </app-learn-vocabulary-card>
      }
      @case ('speech') {
        <app-learn-speech-card
          [card]="cardResource"
          [isRevealed]="isRevealed()"
          [onPlayAudio]="playAudioForContent.bind(this)">
        </app-learn-speech-card>
      }
      @case ('grammar') {
        <app-learn-grammar-card
          [card]="cardResource"
          [isRevealed]="isRevealed()"
          [onPlayAudio]="playAudioForContent.bind(this)">
        </app-learn-grammar-card>
      }
    }
  </div>

  @if (isRevealed()) {
    <app-card-grading-buttons
      [card]="cardResource"
      [learningPartnerId]="currentTurn().partnerId"
      (cardProcessed)="onCardProcessed()">
    </app-card-grading-buttons>
  }
</div>
}
